<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libvisual: lv_ringbuffer.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libvisual
   &#160;<span id="projectnumber">0.5.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">lv_ringbuffer.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lv__ringbuffer_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Libvisual - The audio visualisation framework.</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2004, 2005, 2006 Dennis Smit &lt;ds@nerds-incorporated.org&gt;</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Authors: Dennis Smit &lt;ds@nerds-incorporated.org&gt;</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * $Id: lv_ringbuffer.c,v 1.8 2006/01/22 13:23:37 synap Exp $</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment"> * it under the terms of the GNU Lesser General Public License as</span>
<a name="l00011"></a>00011 <span class="comment"> * published by the Free Software Foundation; either version 2.1</span>
<a name="l00012"></a>00012 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment"> * GNU Lesser General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00020"></a>00020 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00021"></a>00021 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00022"></a>00022 <span class="comment"> */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;config.h&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="lv__ringbuffer_8h.html">lv_ringbuffer.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="lv__common_8h.html">lv_common.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;gettext.h&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">static</span> <span class="keywordtype">int</span> ringbuffer_dtor (<a class="code" href="struct__VisObject.html" title="The VisObject structure contains all the VisObject housekeeping data like refcounting and a pointer t...">VisObject</a> *<span class="keywordtype">object</span>);
<a name="l00030"></a>00030 <span class="keyword">static</span> <span class="keywordtype">int</span> ringbuffer_entry_dtor (<a class="code" href="struct__VisObject.html" title="The VisObject structure contains all the VisObject housekeeping data like refcounting and a pointer t...">VisObject</a> *<span class="keywordtype">object</span>);
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">static</span> <span class="keywordtype">int</span> fixate_with_partial_data_request (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *data, <span class="keywordtype">int</span> offset, <span class="keywordtype">int</span> nbytes,
<a name="l00033"></a>00033         <span class="keywordtype">int</span> *buffercorr);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">static</span> <span class="keywordtype">int</span> ringbuffer_dtor (<a class="code" href="struct__VisObject.html" title="The VisObject structure contains all the VisObject housekeeping data like refcounting and a pointer t...">VisObject</a> *<span class="keywordtype">object</span>)
<a name="l00037"></a>00037 {
<a name="l00038"></a>00038     <a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer = <a class="code" href="group__VisRingBuffer.html#ga59be2d87bf13be1ea7cbbb2e7e344d6b">VISUAL_RINGBUFFER</a> (<span class="keywordtype">object</span>);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040     <span class="keywordflow">if</span> (ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a> != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00041"></a>00041         <a class="code" href="group__VisObject.html#gafd90dd70679ecae99a4a55cd605556b6" title="Decreases the reference counter for a VisObject.">visual_object_unref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a>));
<a name="l00042"></a>00042 
<a name="l00043"></a>00043     ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00046"></a>00046 }
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="keyword">static</span> <span class="keywordtype">int</span> ringbuffer_entry_dtor (<a class="code" href="struct__VisObject.html" title="The VisObject structure contains all the VisObject housekeeping data like refcounting and a pointer t...">VisObject</a> *<span class="keywordtype">object</span>)
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry = <a class="code" href="group__VisRingBuffer.html#gaa60899f0df9b12314b8686c6a28daed7">VISUAL_RINGBUFFER_ENTRY</a> (<span class="keywordtype">object</span>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a1d929d6457ee2e562e8552ffc2363e8c" title="Normal byte buffer.">VISUAL_RINGBUFFER_ENTRY_TYPE_BUFFER</a>) {
<a name="l00053"></a>00053 
<a name="l00054"></a>00054         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a> != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00055"></a>00055             <a class="code" href="group__VisObject.html#gafd90dd70679ecae99a4a55cd605556b6" title="Decreases the reference counter for a VisObject.">visual_object_unref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a>));
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a48c5d1744d7fa72428ec53629deece6b" title="Data retrieval using a callback.">VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION</a>) {
<a name="l00058"></a>00058 
<a name="l00059"></a>00059         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a9aa8c56b418cffefbef8ff8b630621bb">destroyfunc</a> != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00060"></a>00060             entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a9aa8c56b418cffefbef8ff8b630621bb">destroyfunc</a> (entry);
<a name="l00061"></a>00061     }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> = <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a73b734a600bbaf6fb3b184a02647e2b4" title="State less entry.">VISUAL_RINGBUFFER_ENTRY_TYPE_NONE</a>;
<a name="l00064"></a>00064     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00065"></a>00065     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a9aa8c56b418cffefbef8ff8b630621bb">destroyfunc</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00066"></a>00066     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a97372c6656fcd48cce0f1fc47971ff75">sizefunc</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00067"></a>00067     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00068"></a>00068     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a6ceb4f563e3c7e8a93f0f4558453289e">functiondata</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="group__VisRingBuffer.html#ga0b43a2805429f2dfe923e4cd7b5c8b6b">00073</a> <a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *<a class="code" href="group__VisRingBuffer.html#ga0b43a2805429f2dfe923e4cd7b5c8b6b" title="Creates a new VisRingBuffer structure.">visual_ringbuffer_new</a> ()
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075     <a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     ringbuffer = <a class="code" href="group__VisMem.html#gacc3a119d795b22d441e0c9189ccc3eee" title="Convenient macro to request n_structs structures of type struct_type initialized to 0...">visual_mem_new0</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a>, 1);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <a class="code" href="group__VisRingBuffer.html#gae5ab9318008127924b5d38960257a60c">visual_ringbuffer_init</a> (ringbuffer);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">/* Do the VisObject initialization */</span>
<a name="l00082"></a>00082     <a class="code" href="group__VisObject.html#gaae00a3546bb578b98c8ffbd5d189c55d" title="Sets whether a VisObject is allocated or not.">visual_object_set_allocated</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (ringbuffer), <a class="code" href="lv__defines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00083"></a>00083     <a class="code" href="group__VisObject.html#ga5da2f29c9d01864d6f2a42f8f0771d42" title="Increases the reference counter for a VisObject.">visual_object_ref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (ringbuffer));
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="keywordflow">return</span> ringbuffer;
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="group__VisRingBuffer.html#gae5ab9318008127924b5d38960257a60c">00088</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#gae5ab9318008127924b5d38960257a60c">visual_ringbuffer_init</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer)
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment">/* Do the VisObject initialization */</span>
<a name="l00093"></a>00093     <a class="code" href="group__VisObject.html#gabd5edf81d6b96ee64d3e5a270163e0d3" title="Clears a VisObject.">visual_object_clear</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (ringbuffer));
<a name="l00094"></a>00094     <a class="code" href="group__VisObject.html#ga07271127d7d996c7b75fe4e652e0fa81" title="Sets the destructor function to a VisObject.">visual_object_set_dtor</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (ringbuffer), ringbuffer_dtor);
<a name="l00095"></a>00095     <a class="code" href="group__VisObject.html#gaae00a3546bb578b98c8ffbd5d189c55d" title="Sets whether a VisObject is allocated or not.">visual_object_set_allocated</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (ringbuffer), <a class="code" href="lv__defines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="comment">/* Reset the VisRingBuffer structure */</span>
<a name="l00098"></a>00098     ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a> = <a class="code" href="group__VisList.html#ga8f75c6091e22dcf79c747c4ae859a7e0" title="Creates a new VisList structure.">visual_list_new</a> (<a class="code" href="group__VisObject.html#ga0bc516433b06f9341288ea1f974908f6" title="This function is a global VisListDestroyerFunc handler that unrefs VisObjects.">visual_object_collection_destroyer</a>);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="group__VisRingBuffer.html#gaaa3815cf09f08e6facfe2bef463db933">00103</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#gaaa3815cf09f08e6facfe2bef463db933" title="Adds a VisRingBufferEntry to the end of the ringbuffer.">visual_ringbuffer_add_entry</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00106"></a>00106     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (entry != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba6f5a698c2008f70aab34c2d409c2c9ee" title="The VisRingBufferEntry is NULL.">VISUAL_ERROR_RINGBUFFER_ENTRY_NULL</a>);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <a class="code" href="group__VisList.html#ga32c42e9fc8a8fdb01c2e832346f71d48" title="Adds an entry at the end of the list.">visual_list_add</a> (ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a>, entry);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="group__VisRingBuffer.html#ga2fbc168c38a079c130ac9390ac77d76e">00113</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#ga2fbc168c38a079c130ac9390ac77d76e" title="Adds a VisBuffer to the end of the ringbuffer.">visual_ringbuffer_add_buffer</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *buffer)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     entry = <a class="code" href="group__VisRingBuffer.html#gad79f4e48157159b972853012d28f6836">visual_ringbuffer_entry_new</a> (buffer);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">return</span> <a class="code" href="group__VisRingBuffer.html#gaaa3815cf09f08e6facfe2bef463db933" title="Adds a VisRingBufferEntry to the end of the ringbuffer.">visual_ringbuffer_add_entry</a> (ringbuffer, entry);
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="group__VisRingBuffer.html#ga6d64f710a5e3aaa925d23214ad17e02f">00124</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#ga6d64f710a5e3aaa925d23214ad17e02f" title="Adds a portion of data to the ringbuffer of nbytes byte size.">visual_ringbuffer_add_buffer_by_data</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> nbytes)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *buffer;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00129"></a>00129     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (data != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba606cf7fa9aaca062a61fce0dcd7c8ef3" title="Something is NULL that shouldn&#39;t be.">VISUAL_ERROR_NULL</a>);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     buffer = <a class="code" href="group__VisBuffer.html#ga7a491b273a48e5775bb34302e92029b3" title="Creates a new VisBuffer with data, datasize and destroyer set.">visual_buffer_new_with_buffer</a> (data, nbytes, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="keywordflow">return</span> <a class="code" href="group__VisRingBuffer.html#ga2fbc168c38a079c130ac9390ac77d76e" title="Adds a VisBuffer to the end of the ringbuffer.">visual_ringbuffer_add_buffer</a> (ringbuffer, buffer);
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="group__VisRingBuffer.html#gaa34ca62c7cd32f9f9ca2916c926afcb2">00136</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#gaa34ca62c7cd32f9f9ca2916c926afcb2">visual_ringbuffer_add_function</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer,
<a name="l00137"></a>00137         <a class="code" href="group__VisRingBuffer.html#ga6562ac42853d37f9f38cd2d189a127a5" title="A VisRingBuffer data provider function needs this signature.">VisRingBufferDataFunc</a> datafunc,
<a name="l00138"></a>00138         <a class="code" href="group__VisRingBuffer.html#gaee80c9a3360c6ce2076ad1cb36e7ccff">VisRingBufferDestroyFunc</a> destroyfunc,
<a name="l00139"></a>00139         <a class="code" href="group__VisRingBuffer.html#gabd5aa78cdb3bbde7010ed6f976ec5055">VisRingBufferSizeFunc</a> sizefunc,
<a name="l00140"></a>00140         <span class="keywordtype">void</span> *functiondata)
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00145"></a>00145     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (datafunc != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba32f94b549b16946aa84c4c1a81767a98" title="The VisRingBufferDataFunc is NULL.">VISUAL_ERROR_RINGBUFFER_DATAFUNC_NULL</a>);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     entry = <a class="code" href="group__VisRingBuffer.html#gaa551e2dba251888bf3046fe8aed77a45">visual_ringbuffer_entry_new_function</a> (datafunc, destroyfunc, sizefunc, functiondata);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="keywordflow">return</span> <a class="code" href="group__VisRingBuffer.html#gaaa3815cf09f08e6facfe2bef463db933" title="Adds a VisRingBufferEntry to the end of the ringbuffer.">visual_ringbuffer_add_entry</a> (ringbuffer, entry);
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="group__VisRingBuffer.html#gacefcb6664a562677b0b59111d76a7d3a">00152</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#gacefcb6664a562677b0b59111d76a7d3a">visual_ringbuffer_get_size</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer)
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154     <a class="code" href="struct__VisListEntry.html" title="The VisListEntry data structure is an entry within the linked list.">VisListEntry</a> *le = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00155"></a>00155     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry;
<a name="l00156"></a>00156     <span class="keywordtype">int</span> totalsize = 0;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="keywordflow">while</span> ((entry = <a class="code" href="group__VisList.html#ga520e39174067f2ed8037850ed608605f" title="Goes to the next entry in the list and return it&#39;s data element.">visual_list_next</a> (ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a>, &amp;le)) != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00161"></a>00161         <span class="keywordtype">int</span> bsize = 0;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a1d929d6457ee2e562e8552ffc2363e8c" title="Normal byte buffer.">VISUAL_RINGBUFFER_ENTRY_TYPE_BUFFER</a>) {
<a name="l00164"></a>00164 
<a name="l00165"></a>00165             <span class="keywordflow">if</span> ((bsize = <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a>)) &gt; 0)
<a name="l00166"></a>00166                     totalsize += bsize;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a48c5d1744d7fa72428ec53629deece6b" title="Data retrieval using a callback.">VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION</a>) {
<a name="l00169"></a>00169 
<a name="l00170"></a>00170             <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a97372c6656fcd48cce0f1fc47971ff75">sizefunc</a> != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00171"></a>00171                 totalsize += entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a97372c6656fcd48cce0f1fc47971ff75">sizefunc</a> (ringbuffer, entry);
<a name="l00172"></a>00172             } <span class="keywordflow">else</span> {
<a name="l00173"></a>00173                 <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *tempbuf = entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> (ringbuffer, entry);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175                 <span class="keywordflow">if</span> ((bsize = <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (tempbuf)) &gt; 0)
<a name="l00176"></a>00176                         totalsize += bsize;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178                 <a class="code" href="group__VisObject.html#gafd90dd70679ecae99a4a55cd605556b6" title="Decreases the reference counter for a VisObject.">visual_object_unref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (tempbuf));
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">return</span> totalsize;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="group__VisRingBuffer.html#ga37b37860d22d772a987f13b645df09fb">00186</a> <a class="code" href="struct__VisList.html" title="The VisList data structure represents a linked list.">VisList</a> *<a class="code" href="group__VisRingBuffer.html#ga37b37860d22d772a987f13b645df09fb" title="Gets a list of all ringbuffer fragments that are currently in the ringbuffer.">visual_ringbuffer_get_list</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="keywordflow">return</span> ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a>;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="group__VisRingBuffer.html#gaca8b65a4c8852f323e5bc14e9d956de1">00193</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#gaca8b65a4c8852f323e5bc14e9d956de1">visual_ringbuffer_get_data</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *data, <span class="keywordtype">int</span> nbytes)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195     <span class="keywordflow">return</span> <a class="code" href="group__VisRingBuffer.html#ga24512f7566a428e8a6ed3c2e00429662">visual_ringbuffer_get_data_offset</a> (ringbuffer, data, 0, nbytes);
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="group__VisRingBuffer.html#ga24512f7566a428e8a6ed3c2e00429662">00198</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#ga24512f7566a428e8a6ed3c2e00429662">visual_ringbuffer_get_data_offset</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *data, <span class="keywordtype">int</span> offset, <span class="keywordtype">int</span> nbytes)
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200     <a class="code" href="struct__VisListEntry.html" title="The VisListEntry data structure is an entry within the linked list.">VisListEntry</a> *le = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00201"></a>00201     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry;
<a name="l00202"></a>00202     <span class="keywordtype">int</span> curposition = 0;
<a name="l00203"></a>00203     <span class="keywordtype">int</span> startat = 0;
<a name="l00204"></a>00204     <span class="keywordtype">int</span> buffercorr = 0;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00207"></a>00207     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (data != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba72eebd52f506084a342d5ca53881c7ec" title="The VisBuffer is NULL.">VISUAL_ERROR_BUFFER_NULL</a>);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="comment">/* Fixate possible partial buffer */</span>
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (offset &gt; 0)
<a name="l00211"></a>00211         startat = fixate_with_partial_data_request (ringbuffer, data, offset, nbytes, &amp;buffercorr);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     curposition = buffercorr;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="comment">/* Buffer fixated with partial segment, request the other segments */</span>
<a name="l00216"></a>00216     <span class="keywordflow">while</span> (curposition &lt; nbytes) {
<a name="l00217"></a>00217         <span class="keywordtype">int</span> lindex = 0;
<a name="l00218"></a>00218         le = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="comment">/* return immediately if there are no elements in the list */</span>
<a name="l00221"></a>00221         <span class="keywordflow">if</span>(<a class="code" href="group__VisList.html#ga9c451ce8f8030ae5b27df64641d9972f" title="Gets the amount of elements in a VisList.">visual_list_count</a>(ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a>) == 0)
<a name="l00222"></a>00222             <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         <span class="keywordflow">while</span> ((entry = <a class="code" href="group__VisList.html#ga520e39174067f2ed8037850ed608605f" title="Goes to the next entry in the list and return it&#39;s data element.">visual_list_next</a> (ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a>, &amp;le)) != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00225"></a>00225             <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *tempbuf = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227             lindex++;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229             <span class="comment">/* Skip to the right offset buffer fragment */</span>
<a name="l00230"></a>00230             <span class="keywordflow">if</span> (lindex &lt;= startat)
<a name="l00231"></a>00231                 <span class="keywordflow">continue</span>;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233             <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a1d929d6457ee2e562e8552ffc2363e8c" title="Normal byte buffer.">VISUAL_RINGBUFFER_ENTRY_TYPE_BUFFER</a>) {
<a name="l00234"></a>00234 
<a name="l00235"></a>00235                 tempbuf = entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a>;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a48c5d1744d7fa72428ec53629deece6b" title="Data retrieval using a callback.">VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION</a>) {
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                 <span class="comment">/* Will bail out through visual_error_raise(), this is fatal, let&#39;s not try to</span>
<a name="l00240"></a>00240 <span class="comment">                 * recover, it&#39;s a very obvious bug in the software */</span>
<a name="l00241"></a>00241                 <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> == <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00242"></a>00242                     <a class="code" href="group__VisLog.html#ga6cb2aa41edb99cc803a3893601f2362c" title="Used for log messages, this is brought under a define so that the __FILE__ and __LINE__ macros (and p...">visual_log</a> (<a class="code" href="group__VisLog.html#gga9fed3305ac1acb555bc97dc26f350e3ba8bf23a2943c56c20c179bb1d75d862c2" title="Error message, use to notify the user of fatals.">VISUAL_LOG_ERROR</a>,
<a name="l00243"></a>00243                             _(<span class="stringliteral">&quot;No VisRingBufferDataFunc data provider function set on &quot;</span>
<a name="l00244"></a>00244                                 <span class="stringliteral">&quot;type VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION&quot;</span>));
<a name="l00245"></a>00245 
<a name="l00246"></a>00246                     <span class="keywordflow">return</span> -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba8f4228439a6155fecc257ce44504a5e3" title="The impossible happened, this should never happen.">VISUAL_ERROR_IMPOSSIBLE</a>;
<a name="l00247"></a>00247                 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249                 tempbuf = entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> (ringbuffer, entry);
<a name="l00250"></a>00250             }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252             <span class="keywordflow">if</span> (curposition + <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (tempbuf) &gt; nbytes) {
<a name="l00253"></a>00253                 <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> buf;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255                 <a class="code" href="group__VisBuffer.html#gad7e0e3062d829ab81360e9426a4fd90f" title="Initializes a VisBuffer, it&#39;s safe to use visual_buffer_set_data_pair on a non heap allocated VisBuff...">visual_buffer_init</a> (&amp;buf, <a class="code" href="group__VisBuffer.html#ga653325b932f38e6d3274042fbd5a36dd" title="Gets pointer to the data that is encapsulated by the VisBuffer.">visual_buffer_get_data</a> (tempbuf),
<a name="l00256"></a>00256                         nbytes - curposition, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                 <a class="code" href="group__VisBuffer.html#gaf08e8f31f2d987e85cdd8caba1f99e01" title="Copies data into the VisBuffer from another VisBuffer starting at byteoffset.">visual_buffer_put</a> (data, &amp;buf, curposition);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260                 <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a48c5d1744d7fa72428ec53629deece6b" title="Data retrieval using a callback.">VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION</a>)
<a name="l00261"></a>00261                     <a class="code" href="group__VisObject.html#gafd90dd70679ecae99a4a55cd605556b6" title="Decreases the reference counter for a VisObject.">visual_object_unref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (tempbuf));
<a name="l00262"></a>00262 
<a name="l00263"></a>00263                 <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00264"></a>00264             }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266             <a class="code" href="group__VisBuffer.html#gaf08e8f31f2d987e85cdd8caba1f99e01" title="Copies data into the VisBuffer from another VisBuffer starting at byteoffset.">visual_buffer_put</a> (data, tempbuf, curposition);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268             curposition += <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (tempbuf);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270             <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a48c5d1744d7fa72428ec53629deece6b" title="Data retrieval using a callback.">VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION</a>)
<a name="l00271"></a>00271                 <a class="code" href="group__VisObject.html#gafd90dd70679ecae99a4a55cd605556b6" title="Decreases the reference counter for a VisObject.">visual_object_unref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (tempbuf));
<a name="l00272"></a>00272 
<a name="l00273"></a>00273             <span class="comment">/* Filled without room for partial buffer addition */</span>
<a name="l00274"></a>00274             <span class="keywordflow">if</span> (curposition == nbytes)
<a name="l00275"></a>00275                 <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278         startat = 0;
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="keyword">static</span> <span class="keywordtype">int</span> fixate_with_partial_data_request (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *data, <span class="keywordtype">int</span> offset, <span class="keywordtype">int</span> nbytes,
<a name="l00285"></a>00285         <span class="keywordtype">int</span> *buffercorr)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287     <a class="code" href="struct__VisListEntry.html" title="The VisListEntry data structure is an entry within the linked list.">VisListEntry</a> *le = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00288"></a>00288     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry;
<a name="l00289"></a>00289     <span class="keywordtype">int</span> curoffset = 0;
<a name="l00290"></a>00290     <span class="keywordtype">int</span> startat = 0;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     *buffercorr = 0;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="keywordflow">while</span> ((entry = <a class="code" href="group__VisList.html#ga520e39174067f2ed8037850ed608605f" title="Goes to the next entry in the list and return it&#39;s data element.">visual_list_next</a> (ringbuffer-&gt;<a class="code" href="struct__VisRingBuffer.html#a765b8004d0ae7b78b0c4bcbf01c064bf" title="The ring buffer entries list.">entries</a>, &amp;le)) != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00295"></a>00295         <span class="keywordtype">int</span> bsize = 0;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         startat++;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a1d929d6457ee2e562e8552ffc2363e8c" title="Normal byte buffer.">VISUAL_RINGBUFFER_ENTRY_TYPE_BUFFER</a>) {
<a name="l00300"></a>00300 
<a name="l00301"></a>00301             <span class="keywordflow">if</span> ((bsize = <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a>)) &gt; 0)
<a name="l00302"></a>00302                 curoffset += bsize;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304             <span class="comment">/* This buffer partially falls within the offset */</span>
<a name="l00305"></a>00305             <span class="keywordflow">if</span> (curoffset &gt; offset) {
<a name="l00306"></a>00306                 <a class="code" href="group__VisBuffer.html#gaa4c340a42a3b803dc4129920b1c50768" title="Copies data into the VisBuffer using a data pointer and it&#39;s size.">visual_buffer_put_data</a> (data,
<a name="l00307"></a>00307                         ((uint8_t *) <a class="code" href="group__VisBuffer.html#ga653325b932f38e6d3274042fbd5a36dd" title="Gets pointer to the data that is encapsulated by the VisBuffer.">visual_buffer_get_data</a> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a>) +
<a name="l00308"></a>00308                         <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a>)) -
<a name="l00309"></a>00309                         (curoffset - offset), curoffset - offset, 0);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311                 *buffercorr = curoffset - offset;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313                 <span class="keywordflow">break</span>;
<a name="l00314"></a>00314             }
<a name="l00315"></a>00315         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> == <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a48c5d1744d7fa72428ec53629deece6b" title="Data retrieval using a callback.">VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION</a>) {
<a name="l00316"></a>00316 
<a name="l00317"></a>00317             <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a97372c6656fcd48cce0f1fc47971ff75">sizefunc</a> != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00318"></a>00318                 curoffset += entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a97372c6656fcd48cce0f1fc47971ff75">sizefunc</a> (ringbuffer, entry);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320                 <span class="comment">/* This buffer partially falls within the offset */</span>
<a name="l00321"></a>00321                 <span class="keywordflow">if</span> (curoffset &gt; offset) {
<a name="l00322"></a>00322 
<a name="l00323"></a>00323                     <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *tempbuf = entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> (ringbuffer, entry);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325                     <a class="code" href="group__VisBuffer.html#gaa4c340a42a3b803dc4129920b1c50768" title="Copies data into the VisBuffer using a data pointer and it&#39;s size.">visual_buffer_put_data</a> (data,
<a name="l00326"></a>00326                             ((uint8_t *) <a class="code" href="group__VisBuffer.html#ga653325b932f38e6d3274042fbd5a36dd" title="Gets pointer to the data that is encapsulated by the VisBuffer.">visual_buffer_get_data</a> (tempbuf) +
<a name="l00327"></a>00327                             <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (tempbuf)) -
<a name="l00328"></a>00328                             (curoffset - offset), curoffset - offset, 0);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330                     <a class="code" href="group__VisObject.html#gafd90dd70679ecae99a4a55cd605556b6" title="Decreases the reference counter for a VisObject.">visual_object_unref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (tempbuf));
<a name="l00331"></a>00331 
<a name="l00332"></a>00332                     *buffercorr = curoffset - offset;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334                     <span class="keywordflow">break</span>;
<a name="l00335"></a>00335                 }
<a name="l00336"></a>00336             } <span class="keywordflow">else</span> {
<a name="l00337"></a>00337                 <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *tempbuf = entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> (ringbuffer, entry);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339                 <span class="keywordflow">if</span> ((bsize = <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (tempbuf)) &gt; 0)
<a name="l00340"></a>00340                     curoffset += bsize;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342                 <span class="comment">/* This buffer partially falls within the offset */</span>
<a name="l00343"></a>00343                 <span class="keywordflow">if</span> (curoffset &gt; offset) {
<a name="l00344"></a>00344                     <a class="code" href="group__VisBuffer.html#gaa4c340a42a3b803dc4129920b1c50768" title="Copies data into the VisBuffer using a data pointer and it&#39;s size.">visual_buffer_put_data</a> (data,
<a name="l00345"></a>00345                             ((uint8_t *) <a class="code" href="group__VisBuffer.html#ga653325b932f38e6d3274042fbd5a36dd" title="Gets pointer to the data that is encapsulated by the VisBuffer.">visual_buffer_get_data</a> (tempbuf) +
<a name="l00346"></a>00346                             <a class="code" href="group__VisBuffer.html#ga68e2f6b1b7ec6a241081522681b17968" title="Gets the size in bytes of a VisBuffer.">visual_buffer_get_size</a> (tempbuf)) -
<a name="l00347"></a>00347                             (curoffset - offset), curoffset - offset, 0);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349                     *buffercorr = curoffset - offset;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351                     <span class="keywordflow">break</span>;
<a name="l00352"></a>00352                 }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354                 <a class="code" href="group__VisObject.html#gafd90dd70679ecae99a4a55cd605556b6" title="Decreases the reference counter for a VisObject.">visual_object_unref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (tempbuf));
<a name="l00355"></a>00355             }
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="keywordflow">return</span> startat;
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00362"></a><a class="code" href="group__VisRingBuffer.html#ga7ed3eecd38d7658142a0f1ac58718196">00362</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#ga7ed3eecd38d7658142a0f1ac58718196">visual_ringbuffer_get_data_from_end</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *data, <span class="keywordtype">int</span> nbytes)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364     <span class="keywordtype">int</span> totalsize = <a class="code" href="group__VisRingBuffer.html#gacefcb6664a562677b0b59111d76a7d3a">visual_ringbuffer_get_size</a> (ringbuffer);
<a name="l00365"></a>00365     <span class="keywordtype">int</span> offset = totalsize - nbytes;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="keywordflow">if</span> ((nbytes / totalsize) &gt; 0)
<a name="l00368"></a>00368         offset = totalsize - (nbytes % totalsize);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="keywordflow">return</span> <a class="code" href="group__VisRingBuffer.html#ga24512f7566a428e8a6ed3c2e00429662">visual_ringbuffer_get_data_offset</a> (ringbuffer, data, offset, nbytes);
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 
<a name="l00373"></a><a class="code" href="group__VisRingBuffer.html#ga1d6e5269a98ecc3880ecf625bd2dbed5">00373</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#ga1d6e5269a98ecc3880ecf625bd2dbed5">visual_ringbuffer_get_data_without_wrap</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *data, <span class="keywordtype">int</span> nbytes)
<a name="l00374"></a>00374 {
<a name="l00375"></a>00375     <span class="keywordtype">int</span> ringsize;
<a name="l00376"></a>00376     <span class="keywordtype">int</span> amount = nbytes;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba59bcfdec91aba9b5e69af683680a1dd2" title="The VisRingBuffer is NULL.">VISUAL_ERROR_RINGBUFFER_NULL</a>);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="keywordflow">if</span> ((ringsize = <a class="code" href="group__VisRingBuffer.html#gacefcb6664a562677b0b59111d76a7d3a">visual_ringbuffer_get_size</a> (ringbuffer)) &lt; nbytes)
<a name="l00381"></a>00381         amount = ringsize;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">return</span> <a class="code" href="group__VisRingBuffer.html#ga24512f7566a428e8a6ed3c2e00429662">visual_ringbuffer_get_data_offset</a> (ringbuffer, data, 0, amount);
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a><a class="code" href="group__VisRingBuffer.html#gaaf66e1aee62fb5dc64d0a0c764e42c3d">00386</a> <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *<a class="code" href="group__VisRingBuffer.html#gaaf66e1aee62fb5dc64d0a0c764e42c3d">visual_ringbuffer_get_data_new</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <span class="keywordtype">int</span> nbytes)
<a name="l00387"></a>00387 {
<a name="l00388"></a>00388     <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *buffer;
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     buffer = <a class="code" href="group__VisBuffer.html#ga1e72431364a96323f77298b345746293" title="Creates a new VisBuffer, allocates data, sets the destroyer.">visual_buffer_new_allocate</a> (nbytes, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     <a class="code" href="group__VisRingBuffer.html#ga24512f7566a428e8a6ed3c2e00429662">visual_ringbuffer_get_data_offset</a> (ringbuffer, buffer, 0, nbytes);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <span class="keywordflow">return</span> buffer;
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="group__VisRingBuffer.html#gab4a6b9dd1da730347cda884403144859">00399</a> <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *<a class="code" href="group__VisRingBuffer.html#gab4a6b9dd1da730347cda884403144859">visual_ringbuffer_get_data_new_without_wrap</a> (<a class="code" href="struct__VisRingBuffer.html" title="The VisRingBuffer data structure holding the ringbuffer.">VisRingBuffer</a> *ringbuffer, <span class="keywordtype">int</span> nbytes)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401     <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *buffer;
<a name="l00402"></a>00402     <span class="keywordtype">int</span> ringsize;
<a name="l00403"></a>00403     <span class="keywordtype">int</span> amount = nbytes;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (ringbuffer != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="keywordflow">if</span> ((ringsize = <a class="code" href="group__VisRingBuffer.html#gacefcb6664a562677b0b59111d76a7d3a">visual_ringbuffer_get_size</a> (ringbuffer)) &lt; nbytes)
<a name="l00408"></a>00408         amount = ringsize;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     buffer = <a class="code" href="group__VisBuffer.html#ga1e72431364a96323f77298b345746293" title="Creates a new VisBuffer, allocates data, sets the destroyer.">visual_buffer_new_allocate</a> (amount, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <a class="code" href="group__VisRingBuffer.html#ga1d6e5269a98ecc3880ecf625bd2dbed5">visual_ringbuffer_get_data_without_wrap</a> (ringbuffer, buffer, amount);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="keywordflow">return</span> buffer;
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="group__VisRingBuffer.html#gad79f4e48157159b972853012d28f6836">00417</a> <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *<a class="code" href="group__VisRingBuffer.html#gad79f4e48157159b972853012d28f6836">visual_ringbuffer_entry_new</a> (<a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *buffer)
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     entry = <a class="code" href="group__VisMem.html#gacc3a119d795b22d441e0c9189ccc3eee" title="Convenient macro to request n_structs structures of type struct_type initialized to 0...">visual_mem_new0</a> (<a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a>, 1);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <a class="code" href="group__VisRingBuffer.html#ga5f6270700f61b495c594f93591fb1447">visual_ringbuffer_entry_init</a> (entry, buffer);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="comment">/* Do the VisObject initialization */</span>
<a name="l00426"></a>00426     <a class="code" href="group__VisObject.html#gaae00a3546bb578b98c8ffbd5d189c55d" title="Sets whether a VisObject is allocated or not.">visual_object_set_allocated</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry), <a class="code" href="lv__defines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00427"></a>00427     <a class="code" href="group__VisObject.html#ga5da2f29c9d01864d6f2a42f8f0771d42" title="Increases the reference counter for a VisObject.">visual_object_ref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry));
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <span class="keywordflow">return</span> entry;
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a><a class="code" href="group__VisRingBuffer.html#ga5f6270700f61b495c594f93591fb1447">00432</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#ga5f6270700f61b495c594f93591fb1447">visual_ringbuffer_entry_init</a> (<a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry, <a class="code" href="struct__VisBuffer.html" title="The VisBuffer data structure holding a buffer and information regarding the buffer.">VisBuffer</a> *buffer)
<a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (entry != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba6f5a698c2008f70aab34c2d409c2c9ee" title="The VisRingBufferEntry is NULL.">VISUAL_ERROR_RINGBUFFER_ENTRY_NULL</a>);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="comment">/* Do the VisObject initialization */</span>
<a name="l00437"></a>00437     <a class="code" href="group__VisObject.html#gabd5edf81d6b96ee64d3e5a270163e0d3" title="Clears a VisObject.">visual_object_clear</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry));
<a name="l00438"></a>00438     <a class="code" href="group__VisObject.html#ga07271127d7d996c7b75fe4e652e0fa81" title="Sets the destructor function to a VisObject.">visual_object_set_dtor</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry), ringbuffer_entry_dtor);
<a name="l00439"></a>00439     <a class="code" href="group__VisObject.html#gaae00a3546bb578b98c8ffbd5d189c55d" title="Sets whether a VisObject is allocated or not.">visual_object_set_allocated</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry), <a class="code" href="lv__defines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="comment">/* Reset the VisRingBufferEntry data */</span>
<a name="l00442"></a>00442     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> = <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a1d929d6457ee2e562e8552ffc2363e8c" title="Normal byte buffer.">VISUAL_RINGBUFFER_ENTRY_TYPE_BUFFER</a>;
<a name="l00443"></a>00443     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00444"></a>00444     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a9aa8c56b418cffefbef8ff8b630621bb">destroyfunc</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00445"></a>00445     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a97372c6656fcd48cce0f1fc47971ff75">sizefunc</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00446"></a>00446     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a> = buffer;
<a name="l00447"></a>00447     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a6ceb4f563e3c7e8a93f0f4558453289e">functiondata</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="group__VisRingBuffer.html#gaa551e2dba251888bf3046fe8aed77a45">00452</a> <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *<a class="code" href="group__VisRingBuffer.html#gaa551e2dba251888bf3046fe8aed77a45">visual_ringbuffer_entry_new_function</a> (
<a name="l00453"></a>00453         <a class="code" href="group__VisRingBuffer.html#ga6562ac42853d37f9f38cd2d189a127a5" title="A VisRingBuffer data provider function needs this signature.">VisRingBufferDataFunc</a> datafunc,
<a name="l00454"></a>00454         <a class="code" href="group__VisRingBuffer.html#gaee80c9a3360c6ce2076ad1cb36e7ccff">VisRingBufferDestroyFunc</a> destroyfunc,
<a name="l00455"></a>00455         <a class="code" href="group__VisRingBuffer.html#gabd5aa78cdb3bbde7010ed6f976ec5055">VisRingBufferSizeFunc</a> sizefunc,
<a name="l00456"></a>00456         <span class="keywordtype">void</span> *functiondata)
<a name="l00457"></a>00457 {
<a name="l00458"></a>00458     <a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     entry = <a class="code" href="group__VisMem.html#gacc3a119d795b22d441e0c9189ccc3eee" title="Convenient macro to request n_structs structures of type struct_type initialized to 0...">visual_mem_new0</a> (<a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a>, 1);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <a class="code" href="group__VisRingBuffer.html#gae062fd2c752cc9b54c2f0dd546b9aa0c">visual_ringbuffer_entry_init_function</a> (entry, datafunc, destroyfunc, sizefunc, functiondata);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="comment">/* Do the VisObject initialization */</span>
<a name="l00465"></a>00465     <a class="code" href="group__VisObject.html#gaae00a3546bb578b98c8ffbd5d189c55d" title="Sets whether a VisObject is allocated or not.">visual_object_set_allocated</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry), <a class="code" href="lv__defines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00466"></a>00466     <a class="code" href="group__VisObject.html#ga5da2f29c9d01864d6f2a42f8f0771d42" title="Increases the reference counter for a VisObject.">visual_object_ref</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry));
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <span class="keywordflow">return</span> entry;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="group__VisRingBuffer.html#gae062fd2c752cc9b54c2f0dd546b9aa0c">00471</a> <span class="keywordtype">int</span> <a class="code" href="group__VisRingBuffer.html#gae062fd2c752cc9b54c2f0dd546b9aa0c">visual_ringbuffer_entry_init_function</a> (<a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry,
<a name="l00472"></a>00472         <a class="code" href="group__VisRingBuffer.html#ga6562ac42853d37f9f38cd2d189a127a5" title="A VisRingBuffer data provider function needs this signature.">VisRingBufferDataFunc</a> datafunc,
<a name="l00473"></a>00473         <a class="code" href="group__VisRingBuffer.html#gaee80c9a3360c6ce2076ad1cb36e7ccff">VisRingBufferDestroyFunc</a> destroyfunc,
<a name="l00474"></a>00474         <a class="code" href="group__VisRingBuffer.html#gabd5aa78cdb3bbde7010ed6f976ec5055">VisRingBufferSizeFunc</a> sizefunc,
<a name="l00475"></a>00475         <span class="keywordtype">void</span> *functiondata)
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (entry != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba6f5a698c2008f70aab34c2d409c2c9ee" title="The VisRingBufferEntry is NULL.">VISUAL_ERROR_RINGBUFFER_ENTRY_NULL</a>);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="comment">/* Do the VisObject initialization */</span>
<a name="l00480"></a>00480     <a class="code" href="group__VisObject.html#gabd5edf81d6b96ee64d3e5a270163e0d3" title="Clears a VisObject.">visual_object_clear</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry));
<a name="l00481"></a>00481     <a class="code" href="group__VisObject.html#ga07271127d7d996c7b75fe4e652e0fa81" title="Sets the destructor function to a VisObject.">visual_object_set_dtor</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry), ringbuffer_entry_dtor);
<a name="l00482"></a>00482     <a class="code" href="group__VisObject.html#gaae00a3546bb578b98c8ffbd5d189c55d" title="Sets whether a VisObject is allocated or not.">visual_object_set_allocated</a> (<a class="code" href="group__VisObject.html#gaf188438cc2a544151f50b4fb4db53e86">VISUAL_OBJECT</a> (entry), <a class="code" href="lv__defines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     <span class="comment">/* Reset the VisRingBufferEntry data */</span>
<a name="l00485"></a>00485     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a781150910308c1edb2b2f34e16548084">type</a> = <a class="code" href="group__VisRingBuffer.html#ggaa94dc566a7d1127c179fb58196ea0228a48c5d1744d7fa72428ec53629deece6b" title="Data retrieval using a callback.">VISUAL_RINGBUFFER_ENTRY_TYPE_FUNCTION</a>;
<a name="l00486"></a>00486     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a7b08a67b7ab6877170c9632c84991956">datafunc</a> = datafunc;
<a name="l00487"></a>00487     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a9aa8c56b418cffefbef8ff8b630621bb">destroyfunc</a> = destroyfunc;
<a name="l00488"></a>00488     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a97372c6656fcd48cce0f1fc47971ff75">sizefunc</a> = sizefunc;
<a name="l00489"></a>00489     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a4872f49a80ddfa4f28efdc2474839b98">buffer</a> = <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00490"></a>00490     entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a6ceb4f563e3c7e8a93f0f4558453289e">functiondata</a> = functiondata;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="keywordflow">return</span> <a class="code" href="group__VisError.html#gga06fc87d81c62e9abb8790b6e5713c55ba73e463399cd84c08294d95cf0b4b7cf8" title="No error.">VISUAL_OK</a>;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a><a class="code" href="group__VisRingBuffer.html#gad1bc59981910b1925de527d68b7a8d01">00495</a> <span class="keywordtype">void</span> *<a class="code" href="group__VisRingBuffer.html#gad1bc59981910b1925de527d68b7a8d01">visual_ringbuffer_entry_get_functiondata</a> (<a class="code" href="struct__VisRingBufferEntry.html" title="The VisRingBufferEntry data structure is an entry within the ringbuffer.">VisRingBufferEntry</a> *entry)
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <a class="code" href="lv__checks_8h.html#a34012d2243c29a51364c5c335781d572" title="Return if val if expr is FALSE, showing a critical message with useful information.">visual_return_val_if_fail</a> (entry != <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="lv__defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="keywordflow">return</span> entry-&gt;<a class="code" href="struct__VisRingBufferEntry.html#a6ceb4f563e3c7e8a93f0f4558453289e">functiondata</a>;
<a name="l00500"></a>00500 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 9 2012 22:25:09 for libvisual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
